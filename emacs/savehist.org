#+title: Savehist
#+property: header-args :results output silent :comments link :noweb tangle
#+hugo_base_dir: ~/Documents/Projects/mac-into-sh/

* Savehist
#+begin_src emacs-lisp
  (use-package savehist
    :straight nil
    :config
    (savehist-mode)
    :custom
    (history-length 1000)
    (history-delete-duplicates t)
    (message-log-max 1000)
    (savehist-save-minibuffer-history t)
    (savehist-additional-variables
     '(buffer-name-history
       command-history
       compile-history
       extended-command-history
       file-name-history
       file-name-history
       global-mark-ring
       Info-history-list
       kill-ring
       kmacro-ring
       last-kbd-macro
       minibuffer-history
       org-link--history
       org-read-date-history
       org-refile-history
       org-table-formula-history
       org-tags-history
       regexp-search-ring
       register-alist
       savehist-minibuffer-history-variables
       shell-command-history
       mark-ring)))
#+end_src

1. Quick fixes:

   ;; the issue could be that save-interprogram-paste-before-kill means a large clipboard which becomes part of savehist:

https://github.com/syl20bnr/spacemacs/issues/9409

#+begin_src emacs-lisp
  (put 'minibuffer-history 'history-length 100)
  (put 'kill-ring 'history-length 25)
  (setq save-interprogram-paste-before-kill nil)
#+end_src

https://emacs.stackexchange.com/questions/4187/strip-text-properties-in-savehist

2. Unpropertize kill ring on quit
#+begin_src emacs-lisp
  (defun actuator-unpropertize-kill-ring ()
    "It do thing."
    (setq kill-ring (mapcar 'substring-no-properties kill-ring)))

  (add-hook 'kill-emacs-hook #'actuator-unpropertize-kill-ring)
  (add-hook 'after-save-hook #'actuator-unpropertize-kill-ring)
#+end_src

3. Savehist on kill only

#+begin_src emacs-lisp
  (setq savehist-autosave-interval nil)
  (add-hook 'kill-emacs-hook #'savehist-save)
  (add-hook 'after-save-hook #'savehist-save)
#+end_src
